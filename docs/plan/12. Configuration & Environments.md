## 12. Configuration & Environments

### Overview
This section defines how AshTrail differentiates behavior between development and production environments, how features are conditionally enabled or disabled, and how sensitive configuration (e.g., Firebase credentials) is managed. The goal is to ensure predictable builds, safe testing, and clear separation between non-production and production data.

---

### Responsibilities
- Provide deterministic environment-specific behavior.
- Prevent accidental use of production services during development.
- Enable or disable features without runtime ambiguity.
- Ensure secrets are not hard-coded or exposed in source control.

---

### 12.1 Build Flavors

#### Build Flavors Overview
Build flavors are used to produce environment-specific builds of the application. Each flavor controls configuration such as backend endpoints, Firebase projects, logging verbosity, and feature availability.

---

### Build Flavors Responsibilities
- Select the correct environment configuration at build time.
- Gate environment-specific services (e.g., Firestore collections).
- Enable stricter validation and observability in non-production builds.

---

### 12.1.1 Development

#### Development Flavor Overview
The development flavor is intended for local development, testing, and experimentation. It prioritizes debuggability and safety over performance or strict validation.

#### Development Flavor Characteristics
- Uses non-production Firebase project.
- Writes to development or test Firestore collections.
- Debug logging enabled.
- Feature flags default to permissive or experimental values.

#### Development Flavor Constraints
- Must never write to production data stores.
- Must clearly identify itself as non-production (e.g., app label, logs).

---

### 12.1.2 Production

#### Production Flavor Overview
The production flavor is intended for end users. It prioritizes stability, data integrity, and minimal observability overhead.

#### Production Flavor Characteristics
- Uses production Firebase project.
- Writes only to production Firestore collections.
- Debug logging disabled or heavily restricted.
- Feature flags default to stable, vetted values.

#### Production Flavor Constraints
- No development-only tools or mock data.
- Secrets must be resolved securely and correctly at build time.

---

### 12.2 Feature Flags

### Feature Flags Overview
Feature flags allow conditional inclusion or exclusion of functionality without branching runtime logic excessively. In AshTrail, feature flags are primarily compile-timeâ€“driven.

---

### Feature Flags Responsibilities
- Gate incomplete or experimental features.
- Allow environment-specific feature availability.
- Avoid runtime feature drift between sessions.

---

### 12.2.1 Compile-Time Flags

#### Compile-Time Flags Overview
Compile-time flags are resolved during the build process and baked into the application binary.

#### Usage
- Enable or disable entire features or code paths.
- Select between alternative implementations.
- Reduce runtime conditional complexity.

#### Compile-Time Flags Constraints
- Changes require a rebuild.
- Flags must be clearly documented and discoverable.

#### Compile-Time Flags Assumptions
- Feature flags are defined in a central location.
- Flags are environment-aware (development vs production).

#### Compile-Time Flags Open Questions
- Are flags managed via Dart `--dart-define` values or build flavor constants?
- Is there a formal naming convention for feature flags?

---

### 12.3 Secrets Management

### Secrets Management Overview
Secrets management covers how sensitive credentials and keys are stored, accessed, and protected across environments.

---

### Secrets Management Responsibilities
- Prevent secrets from being committed to source control.
- Ensure correct secrets are used per environment.
- Support local development without leaking production credentials.

---

### 12.3.1 Firebase Keys

#### Firebase Keys Overview
Firebase keys and configuration values are required to initialize Firebase services such as Authentication and Firestore.

#### Handling
- Stored outside of source control.
- Environment-specific (development vs production).
- Injected at build time or via platform-specific configuration files.

#### Firebase Keys Constraints
- Production Firebase keys must never be bundled with development builds.
- Keys must align with the selected build flavor.

#### Firebase Keys Assumptions
- Firebase configuration files are excluded from version control.
- Separate Firebase projects exist for development and production.

#### Firebase Keys Open Questions
- Are Firebase configs provided via platform files (`google-services.json`, `GoogleService-Info.plist`) or environment variables?
- Is there a documented rotation or revocation process for compromised keys?

---

### Edge Cases & Failure Modes
- Development build accidentally pointing to production Firebase project.
- Missing or misconfigured Firebase keys causing startup failure.
- Feature flag mismatch between documented and actual behavior.
- Build flavor not correctly propagated to runtime configuration.

---

### Future Extensions
- Runtime-configurable feature flags with remote config.
- Automated validation to prevent cross-environment misconfiguration.
- Centralized secrets management service integration.
- Build-time checks enforcing flavor/secret alignment.

---
