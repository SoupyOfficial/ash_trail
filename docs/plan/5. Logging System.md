## 5. Logging System

### 5.1 Overview

#### 5.1.1 Why Logging Is Central

**Logging is the core function of AshTrail.**  
All analytics, insights, trends, and behavioral summaries are derived from log entries.

The system is designed to:

- Capture user activity with minimal friction
- Preserve data offline-first
- Support multi-account separation
- Enable deterministic replay and analysis over time

There is no “secondary” data source for behavior—**logs are the source of truth**.

---

### 5.2 Log Entry Lifecycle

This section describes how a log entry is created, stored, validated, and eventually synchronized.

#### 5.2.1 Creation

Log entries can be created from two primary sources.

#### 5.2.1.1 UI Initiated

Logs created directly through user interaction:

- Time-of entry forms
 	- Includes all input options and a long press button that records the event duration and acts as the submission once the button is released

Characteristics:

- Always tied to a visible user action
- Must pass full client-side validation
- Timestamp assigned at creation time via centralized time abstraction
- Associated with the currently active account and session context

---

#### 5.2.2 Local Persistence

All log entries are persisted locally immediately upon creation.

Local storage characteristics:

- Offline-first
- Durable across app restarts
- Account-scoped
- Append-only by default

Local persistence occurs:

- Before any remote sync attempt
- Regardless of network availability

##### Assumption

- Local persistence uses a structured, queryable store (not raw JSON blobs)

---

#### 5.2.3 Sync Eligibility

A log entry becomes eligible for sync when:

- It passes validation
- It is not marked as deleted
- It has not already been successfully synced
- A remote backend is configured and enabled

Sync metadata may include:

- Sync status (pending / synced / failed)
- Last sync attempt timestamp
- Remote identifier (if synced)

##### Assumption

- Sync eligibility is evaluated lazily, not continuously

##### Open Questions

- Is sync manual, automatic, or hybrid?
- Are retries exponential or fixed-interval?

---

#### 5.2.4 Remote Persistence

When eligible, logs may be written to a remote backend.

Remote persistence characteristics:

- Idempotent writes
- Account-isolated
- Conflict-safe (single-writer assumption)

Remote storage is treated as:

- A backup
- A cross-device sync layer
- A future analytics source

##### Assumption

- Remote persistence failures never block local usage

---

### 5.3 Input Types

AshTrail supports a constrained set of log input types to preserve consistency and enable analysis.

#### 5.3.1 Numeric Inputs

Examples:

- Counts
- Quantities
- Scalar measurements

Rules:

- Must be finite numbers
- No implicit unit conversion
- Stored as raw numeric values

Constraints:

- Upper and lower bounds may apply per field

---

#### 5.3.2 Duration Inputs

Examples:

- Time durations

Rules:

- Stored as normalized durations (not timestamps)
- Must be non-negative
- Precision defined centrally

**Assumption**

- Duration is stored independently of start/end timestamps

---

#### 5.3.3 Boolean Flags

Examples:

- Yes / No markers
- Binary conditions

Rules:

- Explicit true or false
- No tri-state values
- Defaults must be defined

---

### 5.4 Validation Rules

#### 5.4.1 Client-Side Validation

All validation occurs client-side before persistence.

Validation includes:

- Required field presence
- Type correctness
- Value bounds
- Logical consistency between fields

Failure behavior:

- Entry is rejected
- User is notified (UI-initiated only)
- No partial persistence

**Assumption**

- Server-side validation mirrors client rules but does not extend them

**Open Question**

- Are historical logs ever revalidated when rules change?
 	- No

---

### 5.5 Editing & Deletion

Log entries are mutable only under strict rules.

#### 5.5.1 Soft vs Hard Deletes

**Soft Delete**

- Entry is marked as deleted
- Remains in local storage
- Excluded from analytics and sync
- Can be restored

**Hard Delete**

- Entry is permanently removed
- Irreversible
- Used sparingly (e.g., data repair)

**Assumption**

- UI exposes soft delete only
- Hard delete is reserved for internal tools or migrations

---

### 5.6 Assumptions

#### 5.6.1 Single-Writer Model

AshTrail assumes:

- One active writer per account at any time
- No concurrent edits across devices
- Conflicts are avoided by design, not resolved after the fact

This simplifies:

- Sync logic
- Conflict handling
- Data consistency guarantees

**Open Question**

- Will future versions support concurrent multi-device editing?
 	- No
